<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> 全方位色卡管理系統</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            /* 根據 工作表 1 定義的主題色標 */
            --color-winter-blue: #0068A7;
            --color-winter-pale: #D4F0F6;
            --color-winter-pink: #F8B5B5;
            --white: #ffffff;
            --text-dark: #2c3e50;
            --shadow: 0 10px 40px rgba(0, 104, 167, 0.2);
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--color-winter-pale);
            color: var(--text-dark);
            margin: 0; padding: 20px;
        }

        header {
            text-align: center;
            padding: 50px 20px;
            background: linear-gradient(135deg, var(--color-winter-blue), #004d7c);
            color: white;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        .brand-container { display: flex; align-items: center; justify-content: center; gap: 15px; }
        
        /* 解決 Figure 2 右側空白：採用響應式 Grid */
        .color-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .sheet-title {
            grid-column: 1 / -1;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--color-winter-blue);
            margin: 40px 0 20px 0;
            border-bottom: 3px solid var(--color-winter-pink);
        }

        .color-card {
            background: var(--white);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: transform 0.3s ease;
        }

        .color-card:hover { transform: translateY(-8px); }

        .swatch-group { height: 130px; display: flex; }

        .swatch {
            flex: 1; display: flex; align-items: center; justify-content: center;
            font-weight: 700; cursor: pointer; transition: flex 0.4s;
            text-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        .swatch:hover { flex: 2; }

        .card-body { padding: 20px; }
        .card-title { font-size: 1.2rem; font-weight: 700; color: var(--color-winter-blue); margin-bottom: 8px; }
        .card-desc { font-size: 0.9rem; color: #636e72; line-height: 1.4; }

        .copy-btn {
            background: var(--color-winter-blue); color: white; border: none;
            padding: 8px 15px; border-radius: 8px; cursor: pointer; width: 100%;
            margin-top: 15px; font-weight: 700; transition: background 0.2s;
        }
        .copy-btn:hover { background: var(--color-winter-pink); }

        #toast {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: #333; color: white; padding: 12px 30px; border-radius: 50px;
            opacity: 0; transition: opacity 0.3s; z-index: 1000;
        }
    </style>
</head>
<body>

<header>
    <div class="brand-container">
        <h1>線上色卡管理</h1>
    </div>
    <p>自動校正櫨色 ‧ 整合多分頁數據</p>
</header>

<div class="container">
    <div id="resultArea" class="color-grid"></div>
</div>

<div id="toast">複製成功！</div>

<script>
    const resultArea = document.getElementById('resultArea');

    window.addEventListener('load', () => {
        fetch('./color.xlsx')
            .then(res => res.arrayBuffer())
            .then(data => {
                const workbook = XLSX.read(new Uint8Array(data), {type: 'array'});
                renderAllSheets(workbook);
            });
    });

    function renderAllSheets(workbook) {
        resultArea.innerHTML = '';
        workbook.SheetNames.forEach(sheetName => {
            // 跳過工作表 1 (設計標記分頁)
            if (sheetName.includes("工作表1")) return;

            const worksheet = workbook.Sheets[sheetName];
            const jsonData = XLSX.utils.sheet_to_json(worksheet);
            
            if (jsonData.length > 0) {
                const title = document.createElement('div');
                title.className = 'sheet-title';
                title.innerText = sheetName.replace(/栌/g, '櫨'); // 櫨字校正
                resultArea.appendChild(title);
                
                jsonData.forEach(row => {
                    // 解析不同工作表的標題
                    const theme = row['類別 / 主題'] || row['主題名稱'] || row['色卡主題'] || row['色卡名稱 (左 x 右)'];
                    if (!theme) return;

                    const card = document.createElement('div');
                    card.className = 'color-card';
                    
                    // 顏色欄位識別
                    const color1 = row['HEX (主)'] || row['淺色側 (HEX/RGB)'] || row['HEX / RGB (左)'] || row['HEX (左)'];
                    const color2 = row['HEX (次)'] || row['深色/對比側 (HEX/RGB)'] || row['HEX / RGB (右)'] || row['HEX (右)'];
                    const desc = row['視覺關鍵詞'] || row['視覺印象'] || row['應用場景建議'] || row['設計情緒建議'];

                    card.innerHTML = `
                        <div class="swatch-group">
                            <div class="swatch" style="background:${extractHex(color1)}; color:${getContrast(color1)}" onclick="copyText('${extractHex(color1)}')">${extractHex(color1)}</div>
                            <div class="swatch" style="background:${extractHex(color2)}; color:${getContrast(color2)}" onclick="copyText('${extractHex(color2)}')">${extractHex(color2)}</div>
                        </div>
                        <div class="card-body">
                            <div class="card-title">${theme.replace(/栌/g, '櫨')}</div>
                            <div class="card-desc">${desc ? desc.replace(/栌/g, '櫨') : ''}</div>
                            <button class="copy-btn" onclick="copyText('${extractHex(color1)}, ${extractHex(color2)}')">複製代碼</button>
                        </div>
                    `;
                    resultArea.appendChild(card);
                });
            }
        });
    }

    function extractHex(val) {
        if (!val) return '#ccc';
        const match = String(val).match(/#[0-9A-Fa-f]{6}/);
        return match ? match[0] : String(val).split('/')[0].trim();
    }

    function copyText(txt) {
        navigator.clipboard.writeText(txt).then(() => {
            const t = document.getElementById('toast');
            t.style.opacity = '1';
            setTimeout(() => t.style.opacity = '0', 2000);
        });
    }

    function getContrast(hex) {
        const h = extractHex(hex).replace('#', '');
        const r = parseInt(h.substr(0,2),16), g = parseInt(h.substr(2,2),16), b = parseInt(h.substr(4,2),16);
        return ((r*299+g*587+b*114)/1000) > 128 ? '#000' : '#fff';
    }
</script>
</body>
</html>
