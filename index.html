<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç·šä¸Šè‰²å¡è³‡æ–™åº«</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            /* å†¬æ—¥èŠ±å‰ä¸»é¡Œé…è‰² */
            --color-winter-blue: #0068A7;
            --color-winter-pale: #D4F0F6;
            --color-winter-pink: #F8B5B5;
            --white: #ffffff;
            --text-dark: #2c3e50;
            --shadow: 0 8px 30px rgba(0, 104, 167, 0.15);
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--color-winter-pale);
            color: var(--text-dark);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
            min-height: 100vh;
        }

        header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, var(--color-winter-blue), #004d7c);
            color: white;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 104, 167, 0.3);
            position: relative;
            overflow: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* æœå°‹æ¡† - é è¨­é¡¯ç¤º */
        .search-container {
            position: relative;
            max-width: 600px;
            margin: 0 auto 40px auto;
        }

        .search-box {
            width: 100%;
            padding: 15px 25px;
            border: 2px solid var(--white);
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50px;
            font-size: 1.1rem;
            outline: none;
            box-shadow: var(--shadow);
            font-family: 'Noto Sans TC', sans-serif;
            transition: all 0.3s;
        }

        .search-box:focus {
            background: var(--white);
            border-color: var(--color-winter-blue);
        }

        /* å°å°çš„æ‰‹å‹•ä¸Šå‚³æŒ‰éˆ• (å‚™ç”¨) */
        .manual-upload-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.4);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            margin-top: 15px;
            transition: background 0.3s;
        }

        .manual-upload-btn:hover {
            background: rgba(255, 255, 255, 0.4);
        }

        #fileInput { display: none; }

        /* Grid ä½ˆå±€ */
        .grid-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .sheet-title {
            grid-column: 1 / -1;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--color-winter-blue);
            margin: 40px 0 20px 0;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--color-winter-pink);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sheet-badge {
            font-size: 0.9rem;
            background: var(--color-winter-pink);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
        }

        .color-card {
            background: var(--white);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: transform 0.2s;
            display: flex;
            flex-direction: column;
            animation: fadeIn 0.5s ease forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .color-card:hover {
            transform: translateY(-5px);
        }

        .color-preview-container {
            height: 120px;
            display: flex;
        }

        .color-swatch {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            text-shadow: 0 1px 3px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: flex 0.3s;
        }
        
        .color-swatch:hover {
            flex: 1.5;
        }

        .card-body {
            padding: 20px;
            flex: 1;
        }

        .card-title {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--color-winter-blue);
            margin-bottom: 8px;
        }

        .card-desc {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .btn-copy {
            background: var(--color-winter-blue);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            width: 100%;
            cursor: pointer;
            font-family: 'Noto Sans TC', sans-serif;
            transition: background 0.2s;
        }

        .btn-copy:hover {
            background: var(--color-winter-pink);
        }

        /* Toast */
        #toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: #2c3e50;
            color: white;
            padding: 12px 30px;
            border-radius: 50px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 9999;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .loading-state {
            text-align: center;
            padding: 50px;
            color: var(--color-winter-blue);
            font-size: 1.2rem;
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 104, 167, 0.1);
            border-left-color: var(--color-winter-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* éŒ¯èª¤è¨Šæ¯ */
        .error-msg {
            color: #e74c3c;
            background: #fde8e7;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin: 20px auto;
            max-width: 600px;
            display: none;
        }
    </style>
</head>
<body>

<header>
    <h1>ç·šä¸Šè‰²å¡è³‡æ–™åº«</h1>
    <p>è‡ªå‹•è®€å– color.xlsx â€§ ç¹é«”æ ¡æ­£ â€§ æ™ºæ…§æœå°‹</p>
    
    <input type="file" id="fileInput" accept=".xlsx, .xls">
    <button class="manual-upload-btn" onclick="document.getElementById('fileInput').click()">
        ğŸ“‚ æ‰‹å‹•ä¸Šå‚³å…¶ä»– Excel
    </button>
</header>

<div class="container">
    
    <div class="search-container">
        <input type="text" id="searchInput" class="search-box" placeholder="ğŸ” æœå°‹é¡è‰²åç¨±ã€HEX ä»£ç¢¼æˆ–æè¿°...">
    </div>

    <div id="errorMsg" class="error-msg"></div>

    <div id="loading" class="loading-state">
        <div class="spinner"></div>
        <p>æ­£åœ¨å¾é›²ç«¯è®€å– Excel è‰²è­œ...</p>
    </div>

    <div id="resultArea"></div>

</div>

<div id="toast">å·²è¤‡è£½</div>

<script>
    const resultArea = document.getElementById('resultArea');
    const searchInput = document.getElementById('searchInput');
    const loading = document.getElementById('loading');
    const errorMsg = document.getElementById('errorMsg');
    const fileInput = document.getElementById('fileInput');

    // ç•¶é é¢è¼‰å…¥å®Œæˆæ™‚ï¼Œè‡ªå‹•åŸ·è¡Œ
    window.addEventListener('load', () => {
        loadDefaultFile();
    });

    // 1. è‡ªå‹•è®€å– color.xlsx
    function loadDefaultFile() {
        // ä½¿ç”¨ fetch æŠ“å–åŒä¸€å±¤ç›®éŒ„ä¸‹çš„ color.xlsx
        fetch('./color.xlsx')
            .then(response => {
                if (!response.ok) {
                    throw new Error("æ‰¾ä¸åˆ° color.xlsxï¼Œè«‹ç¢ºèªæª”æ¡ˆå·²ä¸Šå‚³è‡³ GitHub ä¸”æª”åæ­£ç¢ºã€‚");
                }
                return response.arrayBuffer();
            })
            .then(data => {
                const workbook = XLSX.read(new Uint8Array(data), {type: 'array'});
                processWorkbook(workbook);
            })
            .catch(error => {
                showError(error.message);
                loading.style.display = 'none';
            });
    }

    // 2. å…è¨±æ‰‹å‹•ä¸Šå‚³ (å‚™ç”¨åŠŸèƒ½)
    fileInput.addEventListener('change', (e) => {
        if(e.target.files.length) {
            loading.style.display = 'block';
            resultArea.innerHTML = '';
            errorMsg.style.display = 'none';
            
            const reader = new FileReader();
            reader.onload = function(event) {
                const data = new Uint8Array(event.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                processWorkbook(workbook);
            };
            reader.readAsArrayBuffer(e.target.files[0]);
        }
    });

    // 3. è™•ç† Excel è³‡æ–™ (å…±ç”¨é‚è¼¯)
    function processWorkbook(workbook) {
        resultArea.innerHTML = '';
        let hasData = false;

        workbook.SheetNames.forEach(sheetName => {
            const worksheet = workbook.Sheets[sheetName];
            const jsonData = XLSX.utils.sheet_to_json(worksheet, {header: 1});

            if(jsonData.length > 1) {
                processSheet(sheetName, jsonData);
                hasData = true;
            }
        });

        loading.style.display = 'none';
        
        if(!hasData) {
            showError("Excel æª”æ¡ˆä¸­ä¼¼ä¹æ²’æœ‰è³‡æ–™ï¼Œæˆ–æ ¼å¼ç„¡æ³•è¾¨è­˜ã€‚");
        }
    }

    // 4. è§£æå–®ä¸€å·¥ä½œè¡¨
    function processSheet(sheetName, data) {
        const section = document.createElement('div');
        const grid = document.createElement('div');
        grid.className = 'grid-section';

        const title = document.createElement('div');
        title.className = 'sheet-title';
        title.innerHTML = `${sheetName} <span class="sheet-badge">${data.length - 1} çµ„é…è‰²</span>`;
        section.appendChild(title);
        section.appendChild(grid);

        // å¾ç¬¬ 2 è¡Œé–‹å§‹è®€ (è·³éæ¨™é¡Œ)
        for(let i=1; i<data.length; i++) {
            const row = data[i];
            if(!row || row.length === 0) continue;

            let colors = [];
            let texts = [];

            row.forEach(cell => {
                if(!cell) return;
                const str = String(cell).trim();
                
                // ç°¡æ˜“ HEX è¾¨è­˜
                const hexMatch = str.match(/#?([0-9A-Fa-f]{6}|[0-9A-Fa-f]{3})/);
                
                if(hexMatch && str.length < 25) { 
                    let cleanHex = hexMatch[0];
                    if(!cleanHex.startsWith('#')) cleanHex = '#' + cleanHex;
                    colors.push(cleanHex);
                } else {
                    // è‡ªå‹•æ–‡å­—æ ¡æ­£ï¼šæ Œ -> æ«¨
                    let fixedText = str.replace(/æ Œ/g, 'æ«¨');
                    texts.push(fixedText);
                }
            });

            if(colors.length > 0) {
                const card = createCard(colors, texts);
                grid.appendChild(card);
            }
        }

        if(grid.children.length > 0) {
            resultArea.appendChild(section);
        }
    }

    // 5. å»ºç«‹å¡ç‰‡ UI
    function createCard(colors, texts) {
        const div = document.createElement('div');
        div.className = 'color-card';

        const previewDiv = document.createElement('div');
        previewDiv.className = 'color-preview-container';
        
        colors.forEach(color => {
            const swatch = document.createElement('div');
            swatch.className = 'color-swatch';
            swatch.style.backgroundColor = color;
            swatch.style.color = getContrastYIQ(color);
            swatch.innerText = color;
            swatch.onclick = () => copyText(color);
            previewDiv.appendChild(swatch);
        });

        const bodyDiv = document.createElement('div');
        bodyDiv.className = 'card-body';
        
        const titleText = texts.length > 0 ? texts[0] : 'æœªå‘½åé…è‰²';
        const descText = texts.length > 1 ? texts.slice(1).join(' / ') : '';

        bodyDiv.innerHTML = `
            <div class="card-title">${titleText}</div>
            <div class="card-desc">${descText}</div>
            <button class="btn-copy" onclick="copyText('${colors.join(', ')}')">è¤‡è£½æ‰€æœ‰ä»£ç¢¼</button>
        `;

        div.appendChild(previewDiv);
        div.appendChild(bodyDiv);
        return div;
    }

    // 6. æœå°‹åŠŸèƒ½
    searchInput.addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase();
        const cards = document.querySelectorAll('.color-card');
        
        cards.forEach(card => {
            const text = card.innerText.toLowerCase();
            if(text.includes(term)) {
                card.style.display = 'flex';
            } else {
                card.style.display = 'none';
            }
        });
    });

    // å·¥å…·å‡½å¼
    function copyText(text) {
        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(text).then(() => showToast(text));
        } else {
            const ta = document.createElement("textarea");
            ta.value = text;
            document.body.appendChild(ta);
            ta.select();
            document.execCommand('copy');
            document.body.removeChild(ta);
            showToast(text);
        }
    }

    function showToast(text) {
        const t = document.getElementById('toast');
        t.innerText = `å·²è¤‡è£½ï¼š${text}`;
        t.style.opacity = 1;
        setTimeout(() => t.style.opacity = 0, 2000);
    }

    function showError(msg) {
        errorMsg.innerText = "âš ï¸ " + msg;
        errorMsg.style.display = 'block';
    }

    function getContrastYIQ(hexcolor){
        hexcolor = hexcolor.replace("#", "");
        if(hexcolor.length === 3) hexcolor = hexcolor.split('').map(c=>c+c).join('');
        var r = parseInt(hexcolor.substr(0,2),16);
        var g = parseInt(hexcolor.substr(2,2),16);
        var b = parseInt(hexcolor.substr(4,2),16);
        var yiq = ((r*299)+(g*587)+(b*114))/1000;
        return (yiq >= 128) ? 'black' : 'white';
    }
</script>

</body>
</html>